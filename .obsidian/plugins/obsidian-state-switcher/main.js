/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};

// src/main.ts
__export(exports, {
  default: () => StateSwitcherPlugin
});
var import_obsidian5 = __toModule(require("obsidian"));

// src/setting.ts
var import_obsidian2 = __toModule(require("obsidian"));

// src/util.ts
var import_obsidian = __toModule(require("obsidian"));
var YAML_REGEX = /^---\n(?:((?:.|\n)*?)\n)?---(?=\n|$)/;
function getObjectYaml(editor) {
  const stringYaml = getYaml(editor);
  return stringYaml ? (0, import_obsidian.parseYaml)(stringYaml.slice(4, -4)) : {};
}
function itemMove(arr, itemIdx1, itemIdx2) {
  [arr[itemIdx1], arr[itemIdx2]] = [arr[itemIdx2], arr[itemIdx1]];
}
function itemAdd(arr, itemIdx, item) {
  arr.splice(itemIdx, 0, item);
}
function itemDelete(arr, itemIndex) {
  arr.splice(itemIndex, 1);
}
function getYaml(editor) {
  var _a;
  const matchResult = editor.getValue().match(YAML_REGEX);
  return (_a = matchResult == null ? void 0 : matchResult[0]) != null ? _a : "";
}
function generateActionKeyword(data) {
  const { editor, action } = data;
  const yamlSection = getYaml(editor);
  const yaml = yamlSection.slice(4, -3);
  const objectYaml = getObjectYaml(editor);
  const objectSnippet = {};
  if (action === "replace")
    objectSnippet[data.key] = data.value;
  if (action === "insert") {
    if (objectYaml[data.key] instanceof Array) {
      objectSnippet[data.key] = [...objectYaml[data.key], data.value];
    } else {
      objectSnippet[data.key] = [data.value];
    }
  }
  if (action === "remove") {
    if (objectYaml[data.key] instanceof Array) {
      const newValue = objectYaml[data.key].filter((val) => val !== data.value);
      objectSnippet[data.key] = newValue.length ? newValue : null;
    } else {
      objectSnippet[data.key] = null;
    }
  }
  if (action === "bulk") {
    Object.entries(data.updateDatas).forEach(([key, value]) => objectSnippet[key] = value);
    data.removeDatas.forEach((key) => objectSnippet[key] = null);
  }
  const replacement = `---
${generateReplacement(yaml, objectSnippet)}---`;
  const startPosition = { line: 0, ch: 0 };
  const endPosition = editor.offsetToPos(yamlSection.length);
  return { replacement, startPosition, endPosition };
}
function generateReplacement(yaml, snippet) {
  return Object.entries(snippet).reduce((temp, [key, value]) => {
    const YAML_FIELD_REGEX = new RegExp(`(${key} *:).+?\\n(?=\\S|$)`, "gs");
    const replacement = value === null ? "" : (0, import_obsidian.stringifyYaml)({ [key]: value });
    return temp.match(YAML_FIELD_REGEX) ? temp.replace(YAML_FIELD_REGEX, replacement) : `${temp}${replacement}`;
  }, yaml);
}
function flatYamlFields(yaml, flatFields) {
  const objectYaml = (0, import_obsidian.parseYaml)(yaml.slice(4, -4));
  return flatFields.reduce((temp, key) => {
    const YAML_FIELD_REGEX = new RegExp(`(${key}:).+?(?=\\n\\S|$)`, "gs");
    return temp.match(YAML_FIELD_REGEX) ? temp.replace(YAML_FIELD_REGEX, `$1 [${objectYaml[key].join(", ")}]`) : temp;
  }, yaml);
}
function replace(key, value, editor) {
  const { replacement, startPosition, endPosition } = generateActionKeyword({ key, value, editor, action: "replace" });
  editor.replaceRange(replacement, startPosition, endPosition);
}
function insert(key, value, flat, editor) {
  const { replacement, startPosition, endPosition } = generateActionKeyword({ key, value, editor, action: "insert" });
  const postProcessedReplacement = flat ? flatYamlFields(replacement, [key]) : replacement;
  editor.replaceRange(postProcessedReplacement, startPosition, endPosition);
}
function remove(key, value, flat, editor) {
  const { replacement, startPosition, endPosition } = generateActionKeyword({ key, value, editor, action: "remove" });
  const postProcessedReplacement = flat ? flatYamlFields(replacement, [key]) : replacement;
  editor.replaceRange(postProcessedReplacement, startPosition, endPosition);
}
function bulkUpdate(updateDatas, removeDatas, flatFields, editor) {
  const { replacement, startPosition, endPosition } = generateActionKeyword({ updateDatas, removeDatas, editor, action: "bulk" });
  const flattedReplacement = flatYamlFields(replacement, flatFields);
  editor.replaceRange(flattedReplacement, startPosition, endPosition);
}

// src/setting.ts
var structureMap = {
  keyValue: "key-value",
  keyArray: "key-array"
};
var formatMap = {
  stack: "- item",
  flat: "[item]"
};
var DEFAULT_SETTINGS = {
  stateMaps: [
    {
      key: "state",
      structure: "keyValue",
      values: ["waiting", "ongoing", "completed"]
    }
  ]
};
var FileStateSwitcherSettingTab = class extends import_obsidian2.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Yaml Manager Settings" });
    this.renderNewSettingItemButton(containerEl);
    this.plugin.settings.stateMaps.forEach((field, fieldIndex, fields) => {
      const s = new import_obsidian2.Setting(this.containerEl);
      s.controlEl.addClass("fss-setting-control");
      this.renderSettingItem(s, field, fieldIndex, fields);
      s.infoEl.remove();
    });
  }
  renderNewSettingItemButton(containerEl) {
    new import_obsidian2.Setting(containerEl).setName("Add map").setDesc("Add new key-values map").addButton((button) => {
      button.setTooltip("Add additional map").setButtonText("+").onClick(() => {
        this.plugin.settings.stateMaps.push({
          key: "",
          structure: "keyValue",
          values: [""]
        });
        this.plugin.saveSettings();
        this.display();
      });
    });
  }
  renderSettingItem(s, field, fieldIndex, fields) {
    const metaContainer = s.controlEl.createDiv();
    metaContainer.addClass("fss-meta");
    this.renderMeta(s, metaContainer, field);
    const fieldContainer = s.controlEl.createDiv();
    fieldContainer.addClass("fss-field");
    this.renderField(s, fieldContainer, fields, fieldIndex);
    const valueContainer = s.controlEl.createDiv();
    valueContainer.addClass("fss-values");
    this.renderValue(s, valueContainer, field.values, fields, fieldIndex);
  }
  renderMeta(setting, container, field) {
    const settingItemContainer = container.createDiv({ cls: "setting-item" });
    const infoContainer = settingItemContainer.createDiv({ cls: "setting-item-info" });
    infoContainer.createDiv({ cls: "setting-item-name", text: "Structure" });
    infoContainer.createDiv({ cls: "setting-item-description", text: "Value structure of this field" });
    setting.addDropdown((cb) => {
      var _a;
      cb.addOptions(structureMap).setValue((_a = field.structure) != null ? _a : "keyValue").onChange((value) => {
        if (value === "keyValue")
          delete field.format;
        field.structure = value;
        this.plugin.saveSettings();
        this.display();
      });
    });
    settingItemContainer.appendChild(setting.controlEl.lastChild);
    if (field.structure === "keyArray") {
      const settingItemContainer2 = container.createDiv({ cls: "setting-item" });
      const infoContainer2 = settingItemContainer2.createDiv({ cls: "setting-item-info" });
      infoContainer2.createDiv({ cls: "setting-item-name", text: "Format" });
      infoContainer2.createDiv({ cls: "setting-item-description", text: "Value format of this field" });
      setting.addDropdown((cb) => {
        var _a;
        cb.addOptions(formatMap).setValue((_a = field.format) != null ? _a : "stack").onChange((value) => {
          field.format = value;
          this.plugin.saveSettings();
          this.display();
        });
      });
      settingItemContainer2.appendChild(setting.controlEl.lastChild);
    }
  }
  renderField(setting, container, keys, keyIdx) {
    setting.addExtraButton((button) => {
      button.setIcon("cross").setTooltip("Delete key").onClick(() => {
        itemDelete(keys, keyIdx);
        this.plugin.saveSettings();
        this.display();
      });
    });
    container.appendChild(setting.controlEl.lastChild);
    setting.addText((text) => {
      text.setPlaceholder("Field").setValue(keys[keyIdx].key).onChange((newField) => {
        keys[keyIdx].key = newField;
        this.plugin.saveSettings();
      });
    });
    container.appendChild(setting.controlEl.lastChild);
  }
  renderValue(setting, container, values, keys, keyIdx) {
    values.forEach((value, valueIndex, values2) => {
      const valueContainer = setting.controlEl.createDiv();
      valueContainer.addClass("fss-values-value");
      container.appendChild(valueContainer);
      setting.addText((text) => {
        text.setPlaceholder(`Value${valueIndex + 1}`).setValue(value).onChange((newValue) => {
          values2[valueIndex] = newValue;
          this.plugin.saveSettings();
        });
      });
      valueContainer.appendChild(setting.controlEl.lastChild);
      setting.addExtraButton((cb) => {
        cb.setIcon("up-chevron-glyph").setTooltip("Move up").onClick(() => {
          if (valueIndex !== 0) {
            itemMove(values2, valueIndex - 1, valueIndex);
            this.plugin.saveSettings();
            this.display();
          }
        });
      });
      valueContainer.appendChild(setting.controlEl.lastChild);
      setting.addExtraButton((cb) => {
        cb.setIcon("down-chevron-glyph").setTooltip("Move down").onClick(() => {
          if (valueIndex !== values2.length - 1) {
            itemMove(values2, valueIndex, valueIndex + 1);
            this.plugin.saveSettings();
            this.display();
          }
        });
      });
      valueContainer.appendChild(setting.controlEl.lastChild);
      setting.addExtraButton((cb) => {
        cb.setIcon("plus").setTooltip("Add").onClick(() => {
          itemAdd(values2, valueIndex + 1, "");
          this.plugin.saveSettings();
          this.display();
        });
      });
      valueContainer.appendChild(setting.controlEl.lastChild);
      setting.addExtraButton((cb) => {
        cb.setIcon("cross").setTooltip("Delete").onClick(() => {
          if (values2.length === 1) {
            itemDelete(keys, keyIdx);
          } else {
            itemDelete(values2, valueIndex);
          }
          this.plugin.saveSettings();
          this.display();
        });
      });
      valueContainer.appendChild(setting.controlEl.lastChild);
    });
  }
};

// src/suggester.ts
var import_obsidian3 = __toModule(require("obsidian"));
var Suggester = class extends import_obsidian3.FuzzySuggestModal {
  constructor(app, displayItems, items) {
    super(app);
    this.displayItems = displayItems;
    this.items = items;
    this.state = "pending";
    this.promise = new Promise((resolve, reject) => {
      this.resolvePromise = (value) => {
        this.state = "resolved";
        resolve(value);
      };
      this.rejectPromise = (reason) => {
        this.state = "rejected";
        reject(reason);
      };
    });
    this.open();
  }
  static Suggest(app, displayItems, items) {
    const suggester = new Suggester(app, displayItems, items);
    return suggester.promise;
  }
  getItems() {
    return this.items;
  }
  getItemText(item) {
    return this.displayItems[this.items.indexOf(item)];
  }
  onChooseItem(item, evt) {
  }
  selectSuggestion(value, evt) {
    this.resolvePromise(value.item);
    super.selectSuggestion(value, evt);
  }
  onClose() {
    if (this.state !== "resolved")
      this.rejectPromise("Nothing selected");
    super.onClose();
  }
};

// src/bulkUpdateModal.ts
var import_obsidian4 = __toModule(require("obsidian"));
var BulkUpdateModal = class extends import_obsidian4.Modal {
  constructor(app, settings, currentFrontmatter) {
    super(app);
    this.state = "pending";
    this.promise = new Promise((resolve, reject) => {
      this.resolvePromise = (value) => {
        this.state = "resolved";
        resolve(value);
      };
      this.rejectPromise = (reason) => {
        this.state = "rejected";
        reject(reason);
      };
    });
    this.generateData(settings, currentFrontmatter);
    this.renderModal();
    this.addConfirm();
    this.addClose();
    this.open();
  }
  static Generate(app, settings, currentFrontmatter) {
    return __async(this, null, function* () {
      const modal = new BulkUpdateModal(app, settings, currentFrontmatter);
      return modal.promise;
    });
  }
  renderModal() {
    const { modalEl, titleEl } = this;
    modalEl.classList.add("yaml_manager-bulk_update_modal");
    titleEl.setText("Yaml");
    this.renderModalContent();
  }
  renderModalContent() {
    const { contentEl } = this;
    contentEl.empty();
    this.datas.forEach((field) => {
      const fieldContainer = contentEl.createDiv();
      fieldContainer.classList.add("field");
      const fieldKeyContainer = fieldContainer.createDiv();
      fieldKeyContainer.classList.add("field_key_container");
      const applyFieldSwitcher = this.addCheckBox(fieldKeyContainer, {
        change: (event) => {
          field.apply = !field.apply;
          this.renderModalContent();
        }
      });
      applyFieldSwitcher.checked = field.apply;
      fieldKeyContainer.appendText(field.key + ":");
      const fieldValuesContaienr = fieldContainer.createDiv();
      fieldValuesContaienr.classList.add("field_value_container");
      field.values.forEach((value) => {
        const label = fieldValuesContaienr.createEl("label");
        label.classList.add("field_value");
        let input;
        if (field.structure === "keyValue") {
          input = this.addRadio(label, {
            change: (e) => {
              field.current = e.target.value;
            }
          });
          input.checked = field.current === value ? true : false;
        }
        if (field.structure === "keyArray") {
          input = this.addCheckBox(label, {
            change: (e) => {
              const value2 = e.target.value;
              field.current.has(value2) ? field.current.delete(value2) : field.current.add(value2);
            }
          });
          input.checked = field.current.has(value) ? true : false;
        }
        if (!applyFieldSwitcher.checked) {
          input.disabled = true;
          input.classList.add("disabled");
        }
        input.name = field.key;
        input.value = value;
        label.appendText(value);
      });
    });
  }
  generateData(settings, currentFrontmatter) {
    this.datas = [];
    settings.forEach(({ key, values, structure }) => {
      const apply = currentFrontmatter[key] ? true : false;
      let current;
      if (structure === "keyValue")
        current = typeof currentFrontmatter[key] === "string" ? currentFrontmatter[key] : "";
      if (structure === "keyArray")
        current = currentFrontmatter[key] instanceof Array ? new Set(currentFrontmatter[key]) : new Set([]);
      this.datas.push({ key, values, apply, structure, current });
    });
  }
  addCheckBox(container, options) {
    return this.addInput(container, "checkbox", options);
  }
  addRadio(container, options) {
    return this.addInput(container, "radio", options);
  }
  addInput(container, type, options) {
    const input = container.createEl("input");
    input.type = type;
    options && Object.entries(options).forEach(([event, handler]) => {
      input.addEventListener(event, (e) => {
        handler(e);
      });
    });
    return input;
  }
  addConfirm() {
    const confirmBtn = this.addBtn("Confirm");
    confirmBtn.addEventListener("click", () => {
      this.onConfirm();
    });
  }
  addClose() {
    const closeBtn = this.addBtn("Close");
    closeBtn.addEventListener("click", () => {
      this.close();
    });
  }
  addBtn(text) {
    const { modalEl } = this;
    let container = modalEl.querySelector(".btn_container");
    if (!container) {
      container = modalEl.createDiv();
      container.addClass("btn_container");
    }
    const btn = container.createEl("button");
    btn.classList.add(`btn_${text.toLowerCase()}`);
    btn.setText(text);
    return btn;
  }
  onConfirm() {
    const result = {};
    this.datas.forEach((data) => {
      if (!data.apply)
        return;
      if (data.structure === "keyValue")
        result[data.key] = data.current || void 0;
      if (data.structure === "keyArray")
        result[data.key] = [...data.current];
    });
    this.resolvePromise(result);
    this.close();
  }
  onClose() {
    if (this.state === "pending") {
      this.rejectPromise("Modal closed.");
    }
  }
};

// src/version.ts
function makeCompatible(setting) {
  setting.stateMaps.forEach((map) => {
    var _a;
    map.structure = (_a = map.structure) != null ? _a : "keyValue";
  });
  return setting;
}

// src/main.ts
var StateSwitcherPlugin = class extends import_obsidian5.Plugin {
  constructor() {
    super(...arguments);
    this.constants = {
      turnBack: "\u2B05\uFE0F Back"
    };
  }
  onload() {
    return __async(this, null, function* () {
      console.log("Loading State Switcher");
      yield this.loadSettings();
      this.addCommand({
        id: "keyValueUpdate",
        name: "key-value update",
        editorCallback: (editor, view) => __async(this, null, function* () {
          const source = this.settings.stateMaps.filter((field) => {
            return field.structure === "keyValue";
          });
          let selectionResult;
          try {
            selectionResult = yield this.getUserSelection(editor, source);
          } catch (error) {
            console.log(error);
          }
          if (!selectionResult)
            return;
          const { selectedKey, selectedValue } = selectionResult;
          replace(selectedKey, selectedValue, editor);
        })
      });
      this.addCommand({
        id: "keyArrayInsert",
        name: "key-array insert",
        editorCallback: (editor, view) => __async(this, null, function* () {
          const source = this.settings.stateMaps.filter((field) => {
            return field.structure === "keyArray";
          });
          let selectionResult;
          try {
            selectionResult = yield this.getUserSelection(editor, source, "insert");
          } catch (error) {
            console.log(error);
          }
          if (!selectionResult)
            return;
          const { selectedKey, selectedValue } = selectionResult;
          const shouldFlat = this.getFlatFields().includes(selectedKey);
          insert(selectedKey, selectedValue, shouldFlat, editor);
        })
      });
      this.addCommand({
        id: "keyArrayRemove",
        name: "key-array remove",
        editorCallback: (editor, view) => __async(this, null, function* () {
          const source = this.settings.stateMaps.filter((field) => {
            return field.structure === "keyArray";
          });
          let selectionResult;
          try {
            selectionResult = yield this.getUserSelection(editor, source, "remove");
          } catch (error) {
            console.log(error);
          }
          if (!selectionResult)
            return;
          const { selectedKey, selectedValue } = selectionResult;
          const shouldFlat = this.getFlatFields().includes(selectedKey);
          remove(selectedKey, selectedValue, shouldFlat, editor);
        })
      });
      this.addCommand({
        id: "bulkUpdate",
        name: "bulk update",
        editorCallback: (editor, view) => __async(this, null, function* () {
          const currentFrontmatter = getObjectYaml(editor);
          let updateDatas;
          try {
            updateDatas = yield BulkUpdateModal.Generate(this.app, this.settings.stateMaps, currentFrontmatter);
          } catch (error) {
            console.log(error);
          }
          if (!updateDatas)
            return;
          const removeDatas = this.settings.stateMaps.flatMap((field) => {
            return updateDatas[field.key] ? [] : [field.key];
          });
          const flatFields = this.getFlatFields().filter((key) => key in updateDatas);
          bulkUpdate(updateDatas, removeDatas, flatFields, editor);
        })
      });
      this.addSettingTab(new FileStateSwitcherSettingTab(this.app, this));
    });
  }
  onunload() {
  }
  loadSettings() {
    return __async(this, null, function* () {
      const settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
      this.settings = makeCompatible(settings);
    });
  }
  saveSettings() {
    return __async(this, null, function* () {
      yield this.saveData(this.settings);
    });
  }
  getUserSelection(editor, source, action) {
    return __async(this, null, function* () {
      source = source != null ? source : this.settings.stateMaps;
      const currentFrontmatter = getObjectYaml(editor);
      const nonEmptyField = action === "remove" ? source.filter((map) => map.key && currentFrontmatter[map.key]) : source.filter((map) => map.key);
      if (!nonEmptyField.length) {
        action === "remove" ? new import_obsidian5.Notice("Nothing can be removed") : new import_obsidian5.Notice("No map founded, please check your config");
        return;
      }
      const keys = nonEmptyField.map((field) => field.key);
      try {
        const selectedKey = yield Suggester.Suggest(this.app, keys, keys);
        let values = nonEmptyField.find((field) => field.key === selectedKey).values.filter((values2) => values2);
        if (action) {
          const currentValues = currentFrontmatter[selectedKey];
          if (currentValues) {
            if (action === "insert")
              values = values.filter((value) => !currentValues.includes(value));
            if (action === "remove")
              values = values.filter((value) => currentValues.includes(value));
          }
        }
        values.push(this.constants.turnBack);
        const selectedValue = yield Suggester.Suggest(this.app, values, values);
        if (selectedValue === this.constants.turnBack)
          return yield this.getUserSelection(editor, source, action);
        return { selectedKey, selectedValue };
      } catch (error) {
        console.log(error);
      }
    });
  }
  getFlatFields() {
    return this.settings.stateMaps.filter((setting) => setting.format === "flat").map((setting) => setting.key);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3NldHRpbmcudHMiLCAic3JjL3V0aWwudHMiLCAic3JjL3N1Z2dlc3Rlci50cyIsICJzcmMvYnVsa1VwZGF0ZU1vZGFsLnRzIiwgInNyYy92ZXJzaW9uLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBFZGl0b3IsIE1hcmtkb3duVmlldywgTm90aWNlLCBQbHVnaW4gfSBmcm9tICdvYnNpZGlhbic7XG5cbmltcG9ydCB7IFN0YXRlU3dpdGNoZXJTZXR0aW5ncywgRmlsZVN0YXRlU3dpdGNoZXJTZXR0aW5nVGFiLCBERUZBVUxUX1NFVFRJTkdTLCBLZXlBcnJheURhdGEgfSBmcm9tICcuL3NldHRpbmcnO1xuaW1wb3J0IFN1Z2dlc3RlciBmcm9tICcuL3N1Z2dlc3Rlcic7XG5pbXBvcnQgQnVsa1VwZGF0ZU1vZGFsIGZyb20gJy4vYnVsa1VwZGF0ZU1vZGFsJztcbmltcG9ydCB7IHJlcGxhY2UsIGluc2VydCwgcmVtb3ZlLCBnZXRPYmplY3RZYW1sLCBidWxrVXBkYXRlIH0gZnJvbSAnLi91dGlsJztcbmltcG9ydCB7IG1ha2VDb21wYXRpYmxlIH0gZnJvbSAnLi92ZXJzaW9uJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU3RhdGVTd2l0Y2hlclBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG5cdHNldHRpbmdzOiBTdGF0ZVN3aXRjaGVyU2V0dGluZ3MgO1xuXHRjb25zdGFudHMgPSB7XG5cdFx0dHVybkJhY2s6ICdcdTJCMDVcdUZFMEYgQmFjaycsXG5cdH1cblxuXHRhc3luYyBvbmxvYWQoKSB7XG5cdFx0Y29uc29sZS5sb2coJ0xvYWRpbmcgU3RhdGUgU3dpdGNoZXInKTtcblx0XHRhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuXG5cdFx0Ly8gYWRkIGNvbW1hbmQgdG8gaGFuZGxlIGtleS12YWx1ZSB1cGRhdGVcblx0XHR0aGlzLmFkZENvbW1hbmQoe1xuXHRcdFx0aWQ6ICdrZXlWYWx1ZVVwZGF0ZScsXG5cdFx0XHRuYW1lOiAna2V5LXZhbHVlIHVwZGF0ZScsXG5cdFx0XHRlZGl0b3JDYWxsYmFjazogYXN5bmMgKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcblx0XHRcdFx0Y29uc3Qgc291cmNlID0gdGhpcy5zZXR0aW5ncy5zdGF0ZU1hcHMuZmlsdGVyKChmaWVsZCkgPT4ge1xuXHRcdFx0XHRcdHJldHVybiBmaWVsZC5zdHJ1Y3R1cmUgPT09ICdrZXlWYWx1ZSc7XG5cdFx0XHRcdH0pXG5cdFx0XHRcdGxldCBzZWxlY3Rpb25SZXN1bHQ7XG5cblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRzZWxlY3Rpb25SZXN1bHQgPSBhd2FpdCB0aGlzLmdldFVzZXJTZWxlY3Rpb24oZWRpdG9yLCBzb3VyY2UpO1xuXHRcdFx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKGVycm9yKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICghc2VsZWN0aW9uUmVzdWx0KSByZXR1cm4gO1xuXG5cdFx0XHRcdGNvbnN0IHtzZWxlY3RlZEtleSwgc2VsZWN0ZWRWYWx1ZX0gPSBzZWxlY3Rpb25SZXN1bHQ7XG5cdFx0XHRcdHJlcGxhY2Uoc2VsZWN0ZWRLZXksIHNlbGVjdGVkVmFsdWUsIGVkaXRvcilcblx0XHRcdH1cblx0XHR9KVxuXG5cdFx0Ly8gYWRkIGNvbW1hbmQgdG8gaGFuZGxlIGtleS1hcnJheSBpbnNlcnRcblx0XHR0aGlzLmFkZENvbW1hbmQoe1xuXHRcdFx0aWQ6ICdrZXlBcnJheUluc2VydCcsXG5cdFx0XHRuYW1lOiAna2V5LWFycmF5IGluc2VydCcsXG5cdFx0XHRlZGl0b3JDYWxsYmFjazogYXN5bmMgKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcblx0XHRcdFx0Y29uc3Qgc291cmNlID0gdGhpcy5zZXR0aW5ncy5zdGF0ZU1hcHMuZmlsdGVyKChmaWVsZCkgPT4ge1xuXHRcdFx0XHRcdHJldHVybiBmaWVsZC5zdHJ1Y3R1cmUgPT09ICdrZXlBcnJheSc7XG5cdFx0XHRcdH0pXHRcblx0XHRcdFx0bGV0IHNlbGVjdGlvblJlc3VsdDtcblxuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdHNlbGVjdGlvblJlc3VsdCA9IGF3YWl0IHRoaXMuZ2V0VXNlclNlbGVjdGlvbihlZGl0b3IsIHNvdXJjZSwgJ2luc2VydCcpO1xuXHRcdFx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKGVycm9yKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICghc2VsZWN0aW9uUmVzdWx0KSByZXR1cm4gO1xuXG5cdFx0XHRcdGNvbnN0IHtzZWxlY3RlZEtleSwgc2VsZWN0ZWRWYWx1ZX0gPSBzZWxlY3Rpb25SZXN1bHQ7XG5cdFx0XHRcdGNvbnN0IHNob3VsZEZsYXQgPSB0aGlzLmdldEZsYXRGaWVsZHMoKS5pbmNsdWRlcyhzZWxlY3RlZEtleSk7XG5cblx0XHRcdFx0aW5zZXJ0KHNlbGVjdGVkS2V5LCBzZWxlY3RlZFZhbHVlLCBzaG91bGRGbGF0LCBlZGl0b3IpO1xuXHRcdFx0fVxuXHRcdH0pXG5cblx0XHQvLyBhZGQgY29tbWFuZCB0byBoYW5kbGUga2V5LWFycmF5IHJlbW92ZVxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XG5cdFx0XHRpZDogJ2tleUFycmF5UmVtb3ZlJyxcblx0XHRcdG5hbWU6ICdrZXktYXJyYXkgcmVtb3ZlJyxcblx0XHRcdGVkaXRvckNhbGxiYWNrOiBhc3luYyAoZWRpdG9yOiBFZGl0b3IsIHZpZXc6IE1hcmtkb3duVmlldykgPT4ge1xuXHRcdFx0XHRjb25zdCBzb3VyY2UgPSB0aGlzLnNldHRpbmdzLnN0YXRlTWFwcy5maWx0ZXIoKGZpZWxkKSA9PiB7XG5cdFx0XHRcdFx0cmV0dXJuIGZpZWxkLnN0cnVjdHVyZSA9PT0gJ2tleUFycmF5Jztcblx0XHRcdFx0fSlcdFxuXHRcdFx0XHRsZXQgc2VsZWN0aW9uUmVzdWx0O1xuXG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0c2VsZWN0aW9uUmVzdWx0ID0gYXdhaXQgdGhpcy5nZXRVc2VyU2VsZWN0aW9uKGVkaXRvciwgc291cmNlLCAncmVtb3ZlJyk7XG5cdFx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coZXJyb3IpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCFzZWxlY3Rpb25SZXN1bHQpIHJldHVybiA7XG5cblx0XHRcdFx0Y29uc3Qge3NlbGVjdGVkS2V5LCBzZWxlY3RlZFZhbHVlfSA9IHNlbGVjdGlvblJlc3VsdDtcblxuXHRcdFx0XHRjb25zdCBzaG91bGRGbGF0ID0gdGhpcy5nZXRGbGF0RmllbGRzKCkuaW5jbHVkZXMoc2VsZWN0ZWRLZXkpO1xuXG5cdFx0XHRcdHJlbW92ZShzZWxlY3RlZEtleSwgc2VsZWN0ZWRWYWx1ZSwgc2hvdWxkRmxhdCwgZWRpdG9yKVxuXHRcdFx0fVxuXHRcdH0pXG5cblx0XHQvLyBidWxrIHVwZGF0ZSB5YW1sIGZyb250IG1hdHRlclxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XG5cdFx0XHRpZDogJ2J1bGtVcGRhdGUnLFxuXHRcdFx0bmFtZTogJ2J1bGsgdXBkYXRlJyxcblx0XHRcdGVkaXRvckNhbGxiYWNrOiBhc3luYyAoZWRpdG9yOiBFZGl0b3IsIHZpZXc6IE1hcmtkb3duVmlldykgPT4ge1xuXHRcdFx0XHRjb25zdCBjdXJyZW50RnJvbnRtYXR0ZXIgPSBnZXRPYmplY3RZYW1sKGVkaXRvcik7XG5cdFx0XHRcdGxldCB1cGRhdGVEYXRhczogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0dXBkYXRlRGF0YXMgPSBhd2FpdCBCdWxrVXBkYXRlTW9kYWwuR2VuZXJhdGUodGhpcy5hcHAsIHRoaXMuc2V0dGluZ3Muc3RhdGVNYXBzLCBjdXJyZW50RnJvbnRtYXR0ZXIpO1xuXHRcdFx0XHR9IGNhdGNoKGVycm9yKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coZXJyb3IpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCF1cGRhdGVEYXRhcykgcmV0dXJuO1xuXG5cdFx0XHRcdGNvbnN0IHJlbW92ZURhdGFzID0gdGhpcy5zZXR0aW5ncy5zdGF0ZU1hcHMuZmxhdE1hcCgoZmllbGQpID0+IHtcblx0XHRcdFx0XHRyZXR1cm4gdXBkYXRlRGF0YXNbZmllbGQua2V5XT8gW106IFtmaWVsZC5rZXldO1xuXHRcdFx0XHR9KVxuXG5cdFx0XHRcdGNvbnN0IGZsYXRGaWVsZHMgPSB0aGlzLmdldEZsYXRGaWVsZHMoKS5maWx0ZXIoKGtleSkgPT4ga2V5IGluIHVwZGF0ZURhdGFzKTtcblxuXHRcdFx0XHRidWxrVXBkYXRlKHVwZGF0ZURhdGFzLCByZW1vdmVEYXRhcywgZmxhdEZpZWxkcywgZWRpdG9yKTtcblx0XHRcdH1cblx0XHR9KVxuXG5cdFx0Ly8gVGhpcyBhZGRzIGEgc2V0dGluZ3MgdGFiIHNvIHRoZSB1c2VyIGNhbiBjb25maWd1cmUgdmFyaW91cyBhc3BlY3RzIG9mIHRoZSBwbHVnaW5cblx0XHR0aGlzLmFkZFNldHRpbmdUYWIobmV3IEZpbGVTdGF0ZVN3aXRjaGVyU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuXHR9XG5cblx0b251bmxvYWQoKSB7XG5cblx0fVxuXG5cdGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcblx0XHRjb25zdCBzZXR0aW5nczogU3RhdGVTd2l0Y2hlclNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcblxuXHRcdHRoaXMuc2V0dGluZ3MgPSBtYWtlQ29tcGF0aWJsZShzZXR0aW5ncyk7XG5cdH1cblxuXHRhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG5cdFx0YXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcblx0fVxuXG5cdGFzeW5jIGdldFVzZXJTZWxlY3Rpb24oZWRpdG9yOiBFZGl0b3IsIHNvdXJjZT86IFN0YXRlU3dpdGNoZXJTZXR0aW5nc1snc3RhdGVNYXBzJ10sIGFjdGlvbj86ICdpbnNlcnQnIHwgJ3JlbW92ZScpOiBQcm9taXNlPHtzZWxlY3RlZEtleTogc3RyaW5nLCBzZWxlY3RlZFZhbHVlOiBzdHJpbmd9PiB7XG5cdFx0c291cmNlID0gc291cmNlID8/IHRoaXMuc2V0dGluZ3Muc3RhdGVNYXBzO1xuXHRcdGNvbnN0IGN1cnJlbnRGcm9udG1hdHRlciA9IGdldE9iamVjdFlhbWwoZWRpdG9yKVxuXHRcdGNvbnN0IG5vbkVtcHR5RmllbGQgPSBhY3Rpb24gPT09ICdyZW1vdmUnXG5cdFx0XHQ/IHNvdXJjZS5maWx0ZXIoKG1hcCkgPT4gbWFwLmtleSAmJiBjdXJyZW50RnJvbnRtYXR0ZXJbbWFwLmtleV0pXG5cdFx0XHQ6IHNvdXJjZS5maWx0ZXIoKG1hcCkgPT4gbWFwLmtleSk7XG5cblx0XHRpZiAoIW5vbkVtcHR5RmllbGQubGVuZ3RoKSB7XG5cdFx0XHRhY3Rpb24gPT09ICdyZW1vdmUnXG5cdFx0XHRcdD8gbmV3IE5vdGljZSgnTm90aGluZyBjYW4gYmUgcmVtb3ZlZCcpXG5cdFx0XHRcdDogbmV3IE5vdGljZSgnTm8gbWFwIGZvdW5kZWQsIHBsZWFzZSBjaGVjayB5b3VyIGNvbmZpZycpO1xuXHRcdFx0cmV0dXJuIDtcblx0XHR9XG5cblx0XHRjb25zdCBrZXlzID0gbm9uRW1wdHlGaWVsZC5tYXAoKGZpZWxkKSA9PiBmaWVsZC5rZXkpO1xuXG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IHNlbGVjdGVkS2V5ID0gYXdhaXQgU3VnZ2VzdGVyLlN1Z2dlc3QodGhpcy5hcHAsIGtleXMsIGtleXMpO1xuXHRcdFx0bGV0IHZhbHVlcyA9IG5vbkVtcHR5RmllbGQuZmluZCgoZmllbGQpID0+IGZpZWxkLmtleSA9PT0gc2VsZWN0ZWRLZXkpLnZhbHVlcy5maWx0ZXIoKHZhbHVlcykgPT4gdmFsdWVzKTtcblxuXHRcdFx0aWYgKGFjdGlvbikge1xuXHRcdFx0XHRjb25zdCBjdXJyZW50VmFsdWVzID0gY3VycmVudEZyb250bWF0dGVyW3NlbGVjdGVkS2V5XTtcblx0XG5cdFx0XHRcdGlmIChjdXJyZW50VmFsdWVzKSB7XG5cdFx0XHRcdFx0aWYgKGFjdGlvbiA9PT0gJ2luc2VydCcpIHZhbHVlcyA9IHZhbHVlcy5maWx0ZXIoKHZhbHVlKSA9PiAhY3VycmVudFZhbHVlcy5pbmNsdWRlcyh2YWx1ZSkpXG5cdFx0XHRcdFx0aWYgKGFjdGlvbiA9PT0gJ3JlbW92ZScpIHZhbHVlcyA9IHZhbHVlcy5maWx0ZXIoKHZhbHVlKSA9PiBjdXJyZW50VmFsdWVzLmluY2x1ZGVzKHZhbHVlKSlcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0dmFsdWVzLnB1c2godGhpcy5jb25zdGFudHMudHVybkJhY2spO1xuXG5cdFx0XHRjb25zdCBzZWxlY3RlZFZhbHVlID0gYXdhaXQgU3VnZ2VzdGVyLlN1Z2dlc3QodGhpcy5hcHAsIHZhbHVlcywgdmFsdWVzKTtcblx0XG5cdFx0XHRpZiAoc2VsZWN0ZWRWYWx1ZSA9PT0gdGhpcy5jb25zdGFudHMudHVybkJhY2spIHJldHVybiBhd2FpdCB0aGlzLmdldFVzZXJTZWxlY3Rpb24oZWRpdG9yLCBzb3VyY2UsIGFjdGlvbik7XG5cblx0XHRcdHJldHVybiB7c2VsZWN0ZWRLZXksIHNlbGVjdGVkVmFsdWV9XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdGNvbnNvbGUubG9nKGVycm9yKVxuXHRcdH1cblx0fVxuXG5cdGdldEZsYXRGaWVsZHMoKSB7XG5cdFx0cmV0dXJuIHRoaXMuc2V0dGluZ3Muc3RhdGVNYXBzXG5cdFx0XHQuZmlsdGVyKChzZXR0aW5nKSA9PiAoc2V0dGluZyBhcyBLZXlBcnJheURhdGEpLmZvcm1hdCA9PT0gJ2ZsYXQnKVxuXHRcdFx0Lm1hcCgoc2V0dGluZykgPT4gc2V0dGluZy5rZXkpO1xuXHR9XG59XG5cbiIsICJpbXBvcnQgeyBBcHAsIEJ1dHRvbkNvbXBvbmVudCwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZyB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5pbXBvcnQgRmlsZVN0YXRlU3dpdGNoZXJQbHVnaW4gZnJvbSBcIi4vbWFpblwiO1xuaW1wb3J0IHsgaXRlbU1vdmUsIGl0ZW1BZGQsIGl0ZW1EZWxldGUgfSBmcm9tIFwiLi91dGlsXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgS2V5VmFsdWVEYXRhIHtcblx0a2V5OiBzdHJpbmc7XG5cdHZhbHVlczogc3RyaW5nW107XG5cdHN0cnVjdHVyZTogJ2tleVZhbHVlJztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBLZXlBcnJheURhdGEge1xuXHRrZXk6IHN0cmluZztcblx0dmFsdWVzOiBzdHJpbmdbXTtcblx0c3RydWN0dXJlOiAna2V5QXJyYXknO1xuXHRmb3JtYXQ6ICdzdGFjaycgfCAnZmxhdCc7XG59XG5cbmV4cG9ydCB0eXBlIEZpZWxkVHlwZSA9IEtleVZhbHVlRGF0YSB8IEtleUFycmF5RGF0YTtcblxuZXhwb3J0IGludGVyZmFjZSBTdGF0ZVN3aXRjaGVyU2V0dGluZ3Mge1xuXHRzdGF0ZU1hcHM6IEZpZWxkVHlwZVtdO1xufVxuXG5jb25zdCBzdHJ1Y3R1cmVNYXAgPSB7XG5cdGtleVZhbHVlOiBcImtleS12YWx1ZVwiLFxuXHRrZXlBcnJheTogXCJrZXktYXJyYXlcIixcbn0gYXMgY29uc3Q7XG5cbmNvbnN0IGZvcm1hdE1hcCA9IHtcblx0c3RhY2s6ICctIGl0ZW0nLFxuXHRmbGF0OiAnW2l0ZW1dJ1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogU3RhdGVTd2l0Y2hlclNldHRpbmdzID0ge1xuXHRzdGF0ZU1hcHM6IFtcblx0XHR7XG5cdFx0XHRrZXk6IFwic3RhdGVcIixcblx0XHRcdHN0cnVjdHVyZTogXCJrZXlWYWx1ZVwiLFxuXHRcdFx0dmFsdWVzOiBbXCJ3YWl0aW5nXCIsIFwib25nb2luZ1wiLCBcImNvbXBsZXRlZFwiXSxcblx0XHR9LFxuXHRdLFxufTtcblxuZXhwb3J0IGNsYXNzIEZpbGVTdGF0ZVN3aXRjaGVyU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuXHRjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcHJpdmF0ZSBwbHVnaW46IEZpbGVTdGF0ZVN3aXRjaGVyUGx1Z2luKSB7XG5cdFx0c3VwZXIoYXBwLCBwbHVnaW4pO1xuXHR9XG5cblx0ZGlzcGxheSgpOiB2b2lkIHtcblx0XHRjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuXG5cdFx0Y29udGFpbmVyRWwuZW1wdHkoKTtcblxuXHRcdGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDJcIiwgeyB0ZXh0OiBcIllhbWwgTWFuYWdlciBTZXR0aW5nc1wiIH0pO1xuXG5cdFx0dGhpcy5yZW5kZXJOZXdTZXR0aW5nSXRlbUJ1dHRvbihjb250YWluZXJFbCk7XG5cblx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy5zdGF0ZU1hcHMuZm9yRWFjaCgoZmllbGQsIGZpZWxkSW5kZXgsIGZpZWxkcykgPT4ge1xuXHRcdFx0Y29uc3QgcyA9IG5ldyBTZXR0aW5nKHRoaXMuY29udGFpbmVyRWwpO1xuXHRcdFx0cy5jb250cm9sRWwuYWRkQ2xhc3MoXCJmc3Mtc2V0dGluZy1jb250cm9sXCIpO1xuXG5cdFx0XHR0aGlzLnJlbmRlclNldHRpbmdJdGVtKHMsIGZpZWxkLCBmaWVsZEluZGV4LCBmaWVsZHMpO1xuXG5cdFx0XHRzLmluZm9FbC5yZW1vdmUoKTtcblx0XHR9KTtcblx0fVxuXG5cdHJlbmRlck5ld1NldHRpbmdJdGVtQnV0dG9uKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCkge1xuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoXCJBZGQgbWFwXCIpXG5cdFx0XHQuc2V0RGVzYyhcIkFkZCBuZXcga2V5LXZhbHVlcyBtYXBcIilcblx0XHRcdC5hZGRCdXR0b24oKGJ1dHRvbjogQnV0dG9uQ29tcG9uZW50KSA9PiB7XG5cdFx0XHRcdGJ1dHRvblxuXHRcdFx0XHRcdC5zZXRUb29sdGlwKFwiQWRkIGFkZGl0aW9uYWwgbWFwXCIpXG5cdFx0XHRcdFx0LnNldEJ1dHRvblRleHQoXCIrXCIpXG5cdFx0XHRcdFx0Lm9uQ2xpY2soKCkgPT4ge1xuXHRcdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3Muc3RhdGVNYXBzLnB1c2goe1xuXHRcdFx0XHRcdFx0XHRrZXk6IFwiXCIsXG5cdFx0XHRcdFx0XHRcdHN0cnVjdHVyZTogXCJrZXlWYWx1ZVwiLFxuXHRcdFx0XHRcdFx0XHR2YWx1ZXM6IFtcIlwiXSxcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdFx0XHR0aGlzLmRpc3BsYXkoKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHR9XG5cblx0cmVuZGVyU2V0dGluZ0l0ZW0oczogU2V0dGluZywgZmllbGQ6IEZpZWxkVHlwZSwgZmllbGRJbmRleDogbnVtYmVyLCBmaWVsZHM6IEZpZWxkVHlwZVtdKSB7XG5cdFx0Y29uc3QgbWV0YUNvbnRhaW5lciA9IHMuY29udHJvbEVsLmNyZWF0ZURpdigpO1xuXHRcdG1ldGFDb250YWluZXIuYWRkQ2xhc3MoXCJmc3MtbWV0YVwiKTtcblx0XHR0aGlzLnJlbmRlck1ldGEocywgbWV0YUNvbnRhaW5lciwgZmllbGQpO1xuXG5cdFx0Y29uc3QgZmllbGRDb250YWluZXIgPSBzLmNvbnRyb2xFbC5jcmVhdGVEaXYoKTtcblx0XHRmaWVsZENvbnRhaW5lci5hZGRDbGFzcyhcImZzcy1maWVsZFwiKTtcblx0XHR0aGlzLnJlbmRlckZpZWxkKHMsIGZpZWxkQ29udGFpbmVyLCBmaWVsZHMsIGZpZWxkSW5kZXgpO1xuXG5cdFx0Y29uc3QgdmFsdWVDb250YWluZXIgPSBzLmNvbnRyb2xFbC5jcmVhdGVEaXYoKTtcblx0XHR2YWx1ZUNvbnRhaW5lci5hZGRDbGFzcyhcImZzcy12YWx1ZXNcIik7XG5cdFx0dGhpcy5yZW5kZXJWYWx1ZShzLCB2YWx1ZUNvbnRhaW5lciwgZmllbGQudmFsdWVzLCBmaWVsZHMsIGZpZWxkSW5kZXgpO1xuXHR9XG5cblx0cmVuZGVyTWV0YShzZXR0aW5nOiBTZXR0aW5nLCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50LCBmaWVsZDogRmllbGRUeXBlKSB7XG5cdFx0Y29uc3Qgc2V0dGluZ0l0ZW1Db250YWluZXIgPSBjb250YWluZXIuY3JlYXRlRGl2KHtjbHM6ICdzZXR0aW5nLWl0ZW0nfSk7XG5cdFx0Y29uc3QgaW5mb0NvbnRhaW5lciA9IHNldHRpbmdJdGVtQ29udGFpbmVyLmNyZWF0ZURpdih7Y2xzOiAnc2V0dGluZy1pdGVtLWluZm8nfSk7XG5cdFx0aW5mb0NvbnRhaW5lci5jcmVhdGVEaXYoe2NsczogJ3NldHRpbmctaXRlbS1uYW1lJywgdGV4dDogJ1N0cnVjdHVyZSd9KVxuXHRcdGluZm9Db250YWluZXIuY3JlYXRlRGl2KHtjbHM6ICdzZXR0aW5nLWl0ZW0tZGVzY3JpcHRpb24nLCB0ZXh0OiAnVmFsdWUgc3RydWN0dXJlIG9mIHRoaXMgZmllbGQnfSlcblxuXHRcdHNldHRpbmcuYWRkRHJvcGRvd24oKGNiKSA9PiB7XG5cdFx0XHRjYi5hZGRPcHRpb25zKHN0cnVjdHVyZU1hcClcblx0XHRcdFx0LnNldFZhbHVlKGZpZWxkLnN0cnVjdHVyZSA/PyBcImtleVZhbHVlXCIpXG5cdFx0XHRcdC5vbkNoYW5nZSgodmFsdWUpID0+IHtcblx0XHRcdFx0XHRpZiAodmFsdWUgPT09ICdrZXlWYWx1ZScpIGRlbGV0ZSAoZmllbGQgYXMgS2V5QXJyYXlEYXRhKS5mb3JtYXRcblx0XHRcdFx0XHRmaWVsZC5zdHJ1Y3R1cmUgPSB2YWx1ZSBhcyBGaWVsZFR5cGVbXCJzdHJ1Y3R1cmVcIl07XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdFx0dGhpcy5kaXNwbGF5KCk7XG5cdFx0XHRcdH0pO1xuXHRcdH0pO1xuXHRcdHNldHRpbmdJdGVtQ29udGFpbmVyLmFwcGVuZENoaWxkKHNldHRpbmcuY29udHJvbEVsLmxhc3RDaGlsZCk7XG5cblx0XHRpZiAoZmllbGQuc3RydWN0dXJlID09PSAna2V5QXJyYXknKSB7XG5cdFx0XHRjb25zdCBzZXR0aW5nSXRlbUNvbnRhaW5lciA9IGNvbnRhaW5lci5jcmVhdGVEaXYoe2NsczogJ3NldHRpbmctaXRlbSd9KTtcblx0XHRcdGNvbnN0IGluZm9Db250YWluZXIgPSBzZXR0aW5nSXRlbUNvbnRhaW5lci5jcmVhdGVEaXYoe2NsczogJ3NldHRpbmctaXRlbS1pbmZvJ30pO1xuXHRcdFx0aW5mb0NvbnRhaW5lci5jcmVhdGVEaXYoe2NsczogJ3NldHRpbmctaXRlbS1uYW1lJywgdGV4dDogJ0Zvcm1hdCd9KTtcblx0XHRcdGluZm9Db250YWluZXIuY3JlYXRlRGl2KHtjbHM6ICdzZXR0aW5nLWl0ZW0tZGVzY3JpcHRpb24nLCB0ZXh0OiAnVmFsdWUgZm9ybWF0IG9mIHRoaXMgZmllbGQnfSk7XG5cblx0XHRcdHNldHRpbmcuYWRkRHJvcGRvd24oKGNiKSA9PiB7XG5cdFx0XHRcdGNiLmFkZE9wdGlvbnMoZm9ybWF0TWFwKVxuXHRcdFx0XHRcdC5zZXRWYWx1ZShmaWVsZC5mb3JtYXQgPz8gJ3N0YWNrJylcblx0XHRcdFx0XHQub25DaGFuZ2UoKHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRmaWVsZC5mb3JtYXQgPSB2YWx1ZSBhcyBLZXlBcnJheURhdGFbJ2Zvcm1hdCddXG5cdFx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHRcdFx0XHRcdHRoaXMuZGlzcGxheSgpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHR9KVxuXHRcdFx0c2V0dGluZ0l0ZW1Db250YWluZXIuYXBwZW5kQ2hpbGQoc2V0dGluZy5jb250cm9sRWwubGFzdENoaWxkKTtcblx0XHR9XG5cdH1cblxuXHRyZW5kZXJGaWVsZChzZXR0aW5nOiBTZXR0aW5nLCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50LCBrZXlzOiBGaWVsZFR5cGVbXSwga2V5SWR4OiBudW1iZXIpIHtcblx0XHQvKipcblx0XHQgKiBEZWxldGUgZmllbGQga2V5XG5cdFx0ICovXG5cdFx0c2V0dGluZy5hZGRFeHRyYUJ1dHRvbigoYnV0dG9uKSA9PiB7XG5cdFx0XHRidXR0b25cblx0XHRcdFx0LnNldEljb24oXCJjcm9zc1wiKVxuXHRcdFx0XHQuc2V0VG9vbHRpcChcIkRlbGV0ZSBrZXlcIilcblx0XHRcdFx0Lm9uQ2xpY2soKCkgPT4ge1xuXHRcdFx0XHRcdGl0ZW1EZWxldGUoa2V5cywga2V5SWR4KTtcblx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHRcdFx0XHR0aGlzLmRpc3BsYXkoKTtcblx0XHRcdFx0fSk7XG5cdFx0fSk7XG5cdFx0Y29udGFpbmVyLmFwcGVuZENoaWxkKHNldHRpbmcuY29udHJvbEVsLmxhc3RDaGlsZCk7XG5cblx0XHQvKipcblx0XHQgKiBEZWZpbmUgZmllbGQga2V5XG5cdFx0ICovXG5cdFx0c2V0dGluZy5hZGRUZXh0KCh0ZXh0KSA9PiB7XG5cdFx0XHR0ZXh0LnNldFBsYWNlaG9sZGVyKFwiRmllbGRcIilcblx0XHRcdFx0LnNldFZhbHVlKGtleXNba2V5SWR4XS5rZXkpXG5cdFx0XHRcdC5vbkNoYW5nZSgobmV3RmllbGQpID0+IHtcblx0XHRcdFx0XHRrZXlzW2tleUlkeF0ua2V5ID0gbmV3RmllbGQ7XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdH0pO1xuXHRcdH0pO1xuXHRcdGNvbnRhaW5lci5hcHBlbmRDaGlsZChzZXR0aW5nLmNvbnRyb2xFbC5sYXN0Q2hpbGQpO1xuXHR9XG5cblx0cmVuZGVyVmFsdWUoc2V0dGluZzogU2V0dGluZywgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCwgdmFsdWVzOiBzdHJpbmdbXSwga2V5czogRmllbGRUeXBlW10sIGtleUlkeDogbnVtYmVyKSB7XG5cdFx0dmFsdWVzLmZvckVhY2goKHZhbHVlLCB2YWx1ZUluZGV4LCB2YWx1ZXMpID0+IHtcblx0XHRcdGNvbnN0IHZhbHVlQ29udGFpbmVyID0gc2V0dGluZy5jb250cm9sRWwuY3JlYXRlRGl2KCk7XG5cdFx0XHR2YWx1ZUNvbnRhaW5lci5hZGRDbGFzcyhcImZzcy12YWx1ZXMtdmFsdWVcIik7XG5cdFx0XHRjb250YWluZXIuYXBwZW5kQ2hpbGQodmFsdWVDb250YWluZXIpO1xuXG5cdFx0XHQvKipcblx0XHRcdCAqIERlZmluZSBmaWVsZCB2YWx1ZVxuXHRcdFx0ICovXG5cdFx0XHRzZXR0aW5nLmFkZFRleHQoKHRleHQpID0+IHtcblx0XHRcdFx0dGV4dC5zZXRQbGFjZWhvbGRlcihgVmFsdWUke3ZhbHVlSW5kZXggKyAxfWApXG5cdFx0XHRcdFx0LnNldFZhbHVlKHZhbHVlKVxuXHRcdFx0XHRcdC5vbkNoYW5nZSgobmV3VmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdHZhbHVlc1t2YWx1ZUluZGV4XSA9IG5ld1ZhbHVlO1xuXHRcdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHRcdHZhbHVlQ29udGFpbmVyLmFwcGVuZENoaWxkKHNldHRpbmcuY29udHJvbEVsLmxhc3RDaGlsZCk7XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogTW92ZSBmaWVsZCB2YWx1ZSB1cFxuXHRcdFx0ICovXG5cdFx0XHRzZXR0aW5nLmFkZEV4dHJhQnV0dG9uKChjYikgPT4ge1xuXHRcdFx0XHRjYi5zZXRJY29uKFwidXAtY2hldnJvbi1nbHlwaFwiKVxuXHRcdFx0XHRcdC5zZXRUb29sdGlwKFwiTW92ZSB1cFwiKVxuXHRcdFx0XHRcdC5vbkNsaWNrKCgpID0+IHtcblx0XHRcdFx0XHRcdGlmICh2YWx1ZUluZGV4ICE9PSAwKSB7XG5cdFx0XHRcdFx0XHRcdGl0ZW1Nb3ZlKHZhbHVlcywgdmFsdWVJbmRleCAtIDEsIHZhbHVlSW5kZXgpO1xuXG5cdFx0XHRcdFx0XHRcdHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHRcdFx0XHR0aGlzLmRpc3BsYXkoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdFx0dmFsdWVDb250YWluZXIuYXBwZW5kQ2hpbGQoc2V0dGluZy5jb250cm9sRWwubGFzdENoaWxkKTtcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBNb3ZlIGZpZWxkIHZhbHVlIGRvd25cblx0XHRcdCAqL1xuXHRcdFx0c2V0dGluZy5hZGRFeHRyYUJ1dHRvbigoY2IpID0+IHtcblx0XHRcdFx0Y2Iuc2V0SWNvbihcImRvd24tY2hldnJvbi1nbHlwaFwiKVxuXHRcdFx0XHRcdC5zZXRUb29sdGlwKFwiTW92ZSBkb3duXCIpXG5cdFx0XHRcdFx0Lm9uQ2xpY2soKCkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHZhbHVlSW5kZXggIT09IHZhbHVlcy5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdFx0XHRcdGl0ZW1Nb3ZlKHZhbHVlcywgdmFsdWVJbmRleCwgdmFsdWVJbmRleCArIDEpO1xuXG5cdFx0XHRcdFx0XHRcdHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHRcdFx0XHR0aGlzLmRpc3BsYXkoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdFx0dmFsdWVDb250YWluZXIuYXBwZW5kQ2hpbGQoc2V0dGluZy5jb250cm9sRWwubGFzdENoaWxkKTtcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBBZGQgbmV3IGZpZWxkIHZhbHVlXG5cdFx0XHQgKi9cblx0XHRcdHNldHRpbmcuYWRkRXh0cmFCdXR0b24oKGNiKSA9PiB7XG5cdFx0XHRcdGNiLnNldEljb24oXCJwbHVzXCIpXG5cdFx0XHRcdFx0LnNldFRvb2x0aXAoXCJBZGRcIilcblx0XHRcdFx0XHQub25DbGljaygoKSA9PiB7XG5cdFx0XHRcdFx0XHRpdGVtQWRkKHZhbHVlcywgdmFsdWVJbmRleCArIDEsIFwiXCIpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHRcdFx0XHRcdHRoaXMuZGlzcGxheSgpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0XHR2YWx1ZUNvbnRhaW5lci5hcHBlbmRDaGlsZChzZXR0aW5nLmNvbnRyb2xFbC5sYXN0Q2hpbGQpO1xuXG5cdFx0XHQvKipcblx0XHRcdCAqIERlbGV0ZSBmaWVsZCB2YWx1ZVxuXHRcdFx0ICovXG5cdFx0XHRzZXR0aW5nLmFkZEV4dHJhQnV0dG9uKChjYikgPT4ge1xuXHRcdFx0XHRjYi5zZXRJY29uKFwiY3Jvc3NcIilcblx0XHRcdFx0XHQuc2V0VG9vbHRpcChcIkRlbGV0ZVwiKVxuXHRcdFx0XHRcdC5vbkNsaWNrKCgpID0+IHtcblx0XHRcdFx0XHRcdGlmICh2YWx1ZXMubGVuZ3RoID09PSAxKSB7XG5cdFx0XHRcdFx0XHRcdGl0ZW1EZWxldGUoa2V5cywga2V5SWR4KTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGl0ZW1EZWxldGUodmFsdWVzLCB2YWx1ZUluZGV4KTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdFx0XHR0aGlzLmRpc3BsYXkoKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdFx0dmFsdWVDb250YWluZXIuYXBwZW5kQ2hpbGQoc2V0dGluZy5jb250cm9sRWwubGFzdENoaWxkKTtcblx0XHR9KTtcblx0fVxufVxuIiwgImltcG9ydCB7IEVkaXRvciwgRWRpdG9yUG9zaXRpb24sIHBhcnNlWWFtbCwgc3RyaW5naWZ5WWFtbCB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5leHBvcnQgY29uc3QgWUFNTF9SRUdFWCA9IC9eLS0tXFxuKD86KCg/Oi58XFxuKSo/KVxcbik/LS0tKD89XFxufCQpLztcblxudHlwZSBDb21tb25VcGRhdGVQYXJhbSA9IHtcbiAgZWRpdG9yOiBFZGl0b3I7XG4gIGtleTogc3RyaW5nO1xuICB2YWx1ZTogc3RyaW5nO1xuICBhY3Rpb246ICdyZXBsYWNlJyB8ICdpbnNlcnQnIHwgJ3JlbW92ZSc7XG59XG5cbnR5cGUgQnVsa1VwZGF0ZVBhcmFtID0ge1xuICBlZGl0b3I6IEVkaXRvcjtcbiAgdXBkYXRlRGF0YXM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICByZW1vdmVEYXRhczogc3RyaW5nW107XG4gIGFjdGlvbjogJ2J1bGsnXG59XG5cbi8vIEdldCBvYmplY3RpZnkgeWFtbCBvZiBjdXJyZW50IGZpbGVcbmV4cG9ydCBmdW5jdGlvbiBnZXRPYmplY3RZYW1sKGVkaXRvcjogRWRpdG9yKSB7XG4gIGNvbnN0IHN0cmluZ1lhbWwgPSBnZXRZYW1sKGVkaXRvcik7XG5cbiAgcmV0dXJuIHN0cmluZ1lhbWw/IHBhcnNlWWFtbChzdHJpbmdZYW1sLnNsaWNlKDQsIC00KSk6IHt9XG59XG5cbi8vIEV4Y2hhbmdlIGl0ZW0gcG9zaXRpb24gaW4gYXJyYXlcbmV4cG9ydCBmdW5jdGlvbiBpdGVtTW92ZTxUPihhcnI6IFRbXSwgaXRlbUlkeDE6IG51bWJlciwgaXRlbUlkeDI6IG51bWJlcik6IHZvaWQge1xuICBbYXJyW2l0ZW1JZHgxXSwgYXJyW2l0ZW1JZHgyXV0gPSBbYXJyW2l0ZW1JZHgyXSwgYXJyW2l0ZW1JZHgxXV07XG59XG5cbi8vIEFkZCBpdGVtIGluIHNwZWNpZmljIHBvc2l0aW9uXG5leHBvcnQgZnVuY3Rpb24gaXRlbUFkZDxUPihhcnI6IFRbXSwgaXRlbUlkeDogbnVtYmVyLCBpdGVtOiBUKTogdm9pZCB7XG4gIGFyci5zcGxpY2UoaXRlbUlkeCwgMCwgaXRlbSlcbn1cblxuLy8gRGVsZXRlIHNwZWNpZmljIGl0ZW0gaW4gYXJyYXlcbmV4cG9ydCBmdW5jdGlvbiBpdGVtRGVsZXRlPFQ+KGFycjogVFtdLCBpdGVtSW5kZXg6IG51bWJlcik6IHZvaWQge1xuICBhcnIuc3BsaWNlKGl0ZW1JbmRleCwgMSk7XG59XG5cbi8vIEdldCB5YW1sIHNlY3Rpb25cbmZ1bmN0aW9uIGdldFlhbWwoZWRpdG9yOiBFZGl0b3IpOiBzdHJpbmcge1xuICBjb25zdCBtYXRjaFJlc3VsdCA9IGVkaXRvci5nZXRWYWx1ZSgpLm1hdGNoKFlBTUxfUkVHRVgpO1xuICBcbiAgcmV0dXJuIG1hdGNoUmVzdWx0Py5bMF0gPz8gJyc7XG59IFxuXG5mdW5jdGlvbiBnZW5lcmF0ZUFjdGlvbktleXdvcmQoZGF0YTogQ29tbW9uVXBkYXRlUGFyYW0gfCBCdWxrVXBkYXRlUGFyYW0pIHtcbiAgY29uc3Qge2VkaXRvciwgYWN0aW9ufSA9IGRhdGE7XG4gIGNvbnN0IHlhbWxTZWN0aW9uID0gZ2V0WWFtbChlZGl0b3IpO1xuICBjb25zdCB5YW1sID0geWFtbFNlY3Rpb24uc2xpY2UoNCwgLTMpO1xuICBjb25zdCBvYmplY3RZYW1sID0gZ2V0T2JqZWN0WWFtbChlZGl0b3IpO1xuICBjb25zdCBvYmplY3RTbmlwcGV0OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9O1xuXG4gIGlmIChhY3Rpb24gPT09ICdyZXBsYWNlJykgb2JqZWN0U25pcHBldFtkYXRhLmtleV0gPSBkYXRhLnZhbHVlO1xuXG4gIGlmIChhY3Rpb24gPT09ICdpbnNlcnQnKSB7XG4gICAgaWYgKG9iamVjdFlhbWxbZGF0YS5rZXldIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIG9iamVjdFNuaXBwZXRbZGF0YS5rZXldID0gWy4uLm9iamVjdFlhbWxbZGF0YS5rZXldLCBkYXRhLnZhbHVlXTsgXG4gICAgfSBlbHNlIHtcbiAgICAgIG9iamVjdFNuaXBwZXRbZGF0YS5rZXldID0gW2RhdGEudmFsdWVdO1xuICAgIH1cbiAgfVxuICBpZiAoYWN0aW9uID09PSAncmVtb3ZlJykge1xuICAgIGlmIChvYmplY3RZYW1sW2RhdGEua2V5XSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICBjb25zdCBuZXdWYWx1ZSA9IG9iamVjdFlhbWxbZGF0YS5rZXldLmZpbHRlcigodmFsOiBzdHJpbmcpID0+IHZhbCAhPT0gZGF0YS52YWx1ZSk7XG4gICAgICBvYmplY3RTbmlwcGV0W2RhdGEua2V5XSA9IG5ld1ZhbHVlLmxlbmd0aD8gbmV3VmFsdWU6IG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9iamVjdFNuaXBwZXRbZGF0YS5rZXldID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBpZiAoYWN0aW9uID09PSAnYnVsaycpIHtcbiAgICBPYmplY3QuZW50cmllcyhkYXRhLnVwZGF0ZURhdGFzKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IG9iamVjdFNuaXBwZXRba2V5XSA9IHZhbHVlICk7XG4gICAgZGF0YS5yZW1vdmVEYXRhcy5mb3JFYWNoKChrZXkpID0+IG9iamVjdFNuaXBwZXRba2V5XSA9IG51bGwpXG4gIH1cblxuICBjb25zdCByZXBsYWNlbWVudCA9IGAtLS1cXG4ke2dlbmVyYXRlUmVwbGFjZW1lbnQoeWFtbCwgb2JqZWN0U25pcHBldCl9LS0tYDtcbiAgY29uc3Qgc3RhcnRQb3NpdGlvbjogRWRpdG9yUG9zaXRpb24gPSB7bGluZTogMCwgY2g6IDB9O1xuICBjb25zdCBlbmRQb3NpdGlvbjogRWRpdG9yUG9zaXRpb24gPSBlZGl0b3Iub2Zmc2V0VG9Qb3MoeWFtbFNlY3Rpb24ubGVuZ3RoKTtcblxuICByZXR1cm4ge3JlcGxhY2VtZW50LCBzdGFydFBvc2l0aW9uLCBlbmRQb3NpdGlvbn1cbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVSZXBsYWNlbWVudCh5YW1sOiBzdHJpbmcsIHNuaXBwZXQ6IFJlY29yZDxzdHJpbmcsIHVua25vd24+KSB7XG4gIHJldHVybiBPYmplY3QuZW50cmllcyhzbmlwcGV0KS5yZWR1Y2UoKHRlbXAsIFtrZXksIHZhbHVlXSkgPT4ge1xuICAgIGNvbnN0IFlBTUxfRklFTERfUkVHRVggPSBuZXcgUmVnRXhwKGAoJHtrZXl9ICo6KS4rP1xcXFxuKD89XFxcXFN8JClgLCAnZ3MnKTtcbiAgXG4gICAgY29uc3QgcmVwbGFjZW1lbnQgPSAodmFsdWUgPT09IG51bGwpPyAnJzogc3RyaW5naWZ5WWFtbCh7W2tleV06IHZhbHVlfSk7XG4gIFxuICAgIHJldHVybiB0ZW1wLm1hdGNoKFlBTUxfRklFTERfUkVHRVgpPyB0ZW1wLnJlcGxhY2UoWUFNTF9GSUVMRF9SRUdFWCwgcmVwbGFjZW1lbnQpOiBgJHt0ZW1wfSR7cmVwbGFjZW1lbnR9YDtcbiAgfSwgeWFtbClcbn1cblxuZnVuY3Rpb24gZmxhdFlhbWxGaWVsZHMoeWFtbDogc3RyaW5nLCBmbGF0RmllbGRzOiBzdHJpbmdbXSk6IHN0cmluZyB7XG4gIGNvbnN0IG9iamVjdFlhbWwgPSBwYXJzZVlhbWwoeWFtbC5zbGljZSg0LCAtNCkpO1xuXG4gIHJldHVybiBmbGF0RmllbGRzLnJlZHVjZSgodGVtcCwga2V5KSA9PiB7XG4gICAgY29uc3QgWUFNTF9GSUVMRF9SRUdFWCA9IG5ldyBSZWdFeHAoYCgke2tleX06KS4rPyg/PVxcXFxuXFxcXFN8JClgLCAnZ3MnKTtcblxuICAgIHJldHVybiB0ZW1wLm1hdGNoKFlBTUxfRklFTERfUkVHRVgpPyB0ZW1wLnJlcGxhY2UoWUFNTF9GSUVMRF9SRUdFWCwgYCQxIFske29iamVjdFlhbWxba2V5XS5qb2luKCcsICcpfV1gKTogdGVtcDtcbiAgfSwgeWFtbClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlcGxhY2Uoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcsIGVkaXRvcjogRWRpdG9yKTogdm9pZCB7XG4gIGNvbnN0IHtyZXBsYWNlbWVudCwgc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb259ID0gZ2VuZXJhdGVBY3Rpb25LZXl3b3JkKHtrZXksIHZhbHVlLCBlZGl0b3IsIGFjdGlvbjogJ3JlcGxhY2UnfSk7XG5cbiAgZWRpdG9yLnJlcGxhY2VSYW5nZShyZXBsYWNlbWVudCwgc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb24pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbnNlcnQoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcsIGZsYXQ6IGJvb2xlYW4sIGVkaXRvcjogRWRpdG9yKTogdm9pZCB7XG4gIGNvbnN0IHtyZXBsYWNlbWVudCwgc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb259ID0gZ2VuZXJhdGVBY3Rpb25LZXl3b3JkKHtrZXksIHZhbHVlLCBlZGl0b3IsIGFjdGlvbjogJ2luc2VydCd9KTtcblxuICBjb25zdCBwb3N0UHJvY2Vzc2VkUmVwbGFjZW1lbnQgPSBmbGF0PyBmbGF0WWFtbEZpZWxkcyhyZXBsYWNlbWVudCwgW2tleV0pOiByZXBsYWNlbWVudDtcblxuICBlZGl0b3IucmVwbGFjZVJhbmdlKHBvc3RQcm9jZXNzZWRSZXBsYWNlbWVudCwgc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb24pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmUoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcsIGZsYXQ6IGJvb2xlYW4sIGVkaXRvcjogRWRpdG9yKTogdm9pZCB7XG4gIGNvbnN0IHtyZXBsYWNlbWVudCwgc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb259ID0gZ2VuZXJhdGVBY3Rpb25LZXl3b3JkKHtrZXksIHZhbHVlLCBlZGl0b3IsIGFjdGlvbjogJ3JlbW92ZSd9KTtcblxuICBjb25zdCBwb3N0UHJvY2Vzc2VkUmVwbGFjZW1lbnQgPSBmbGF0PyBmbGF0WWFtbEZpZWxkcyhyZXBsYWNlbWVudCwgW2tleV0pOiByZXBsYWNlbWVudDtcblxuICBlZGl0b3IucmVwbGFjZVJhbmdlKHBvc3RQcm9jZXNzZWRSZXBsYWNlbWVudCwgc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb24pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBidWxrVXBkYXRlKHVwZGF0ZURhdGFzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiwgcmVtb3ZlRGF0YXM6IHN0cmluZ1tdLCBmbGF0RmllbGRzOiBzdHJpbmdbXSwgZWRpdG9yOiBFZGl0b3IpOiB2b2lkIHtcbiAgY29uc3Qge3JlcGxhY2VtZW50LCBzdGFydFBvc2l0aW9uLCBlbmRQb3NpdGlvbn0gPSBnZW5lcmF0ZUFjdGlvbktleXdvcmQoe3VwZGF0ZURhdGFzLCByZW1vdmVEYXRhcywgZWRpdG9yLCBhY3Rpb246ICdidWxrJ30pO1xuICBcbiAgY29uc3QgZmxhdHRlZFJlcGxhY2VtZW50ID0gZmxhdFlhbWxGaWVsZHMocmVwbGFjZW1lbnQsIGZsYXRGaWVsZHMpO1xuXG4gIGVkaXRvci5yZXBsYWNlUmFuZ2UoZmxhdHRlZFJlcGxhY2VtZW50LCBzdGFydFBvc2l0aW9uLCBlbmRQb3NpdGlvbik7XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBGdXp6eU1hdGNoLCBGdXp6eVN1Z2dlc3RNb2RhbCB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTdWdnZXN0ZXIgZXh0ZW5kcyBGdXp6eVN1Z2dlc3RNb2RhbDxzdHJpbmc+IHtcbiAgcHVibGljIHByb21pc2U6IFByb21pc2U8c3RyaW5nPlxuICBwcml2YXRlIHJlc29sdmVQcm9taXNlOiAodmFsdWU6IHN0cmluZykgPT4gdm9pZDtcbiAgcHJpdmF0ZSByZWplY3RQcm9taXNlOiAocmVhc29uPzogc3RyaW5nKSA9PiB2b2lkO1xuICBwcml2YXRlIHN0YXRlOiAncGVuZGluZycgfCAncmVzb2x2ZWQnIHwgJ3JlamVjdGVkJyA9ICdwZW5kaW5nJztcblxuICBwdWJsaWMgc3RhdGljIFN1Z2dlc3QoYXBwOiBBcHAsIGRpc3BsYXlJdGVtczogc3RyaW5nW10sIGl0ZW1zOiBzdHJpbmdbXSkge1xuICAgIGNvbnN0IHN1Z2dlc3RlciA9IG5ldyBTdWdnZXN0ZXIoYXBwLCBkaXNwbGF5SXRlbXMsIGl0ZW1zKTtcbiAgICByZXR1cm4gc3VnZ2VzdGVyLnByb21pc2U7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcHJpdmF0ZSBkaXNwbGF5SXRlbXM6IHN0cmluZ1tdLCBwcml2YXRlIGl0ZW1zOiBzdHJpbmdbXSkge1xuICAgIHN1cGVyKGFwcClcblxuICAgIHRoaXMucHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UgPSAodmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgICB0aGlzLnN0YXRlID0gJ3Jlc29sdmVkJztcbiAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XG4gICAgICB9O1xuICAgICAgdGhpcy5yZWplY3RQcm9taXNlID0gKHJlYXNvbj86IHN0cmluZykgPT4ge1xuICAgICAgICB0aGlzLnN0YXRlID0gJ3JlamVjdGVkJztcbiAgICAgICAgcmVqZWN0KHJlYXNvbik7XG4gICAgICB9O1xuICAgIH0pXG5cbiAgICB0aGlzLm9wZW4oKVxuICB9XG4gIFxuICBnZXRJdGVtcygpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbXM7XG4gIH1cblxuICBnZXRJdGVtVGV4dChpdGVtOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmRpc3BsYXlJdGVtc1t0aGlzLml0ZW1zLmluZGV4T2YoaXRlbSldXG4gIH1cblxuICBvbkNob29zZUl0ZW0oaXRlbTogc3RyaW5nLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KTogdm9pZCB7fVxuXG4gIHNlbGVjdFN1Z2dlc3Rpb24odmFsdWU6IEZ1enp5TWF0Y2g8c3RyaW5nPiwgZXZ0OiBNb3VzZUV2ZW50IHwgS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgIHRoaXMucmVzb2x2ZVByb21pc2UodmFsdWUuaXRlbSk7XG5cbiAgICBzdXBlci5zZWxlY3RTdWdnZXN0aW9uKHZhbHVlLCBldnQpO1xuICB9XG5cbiAgb25DbG9zZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zdGF0ZSAhPT0gJ3Jlc29sdmVkJykgdGhpcy5yZWplY3RQcm9taXNlKCdOb3RoaW5nIHNlbGVjdGVkJyk7XG5cbiAgICBzdXBlci5vbkNsb3NlKCk7XG4gIH1cbn0iLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IEZpZWxkVHlwZSB9IGZyb20gJy4vc2V0dGluZyc7XG5cbnR5cGUgUmVzdWx0ID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG5cbmludGVyZmFjZSBNb2RhbERhdGE8VCBleHRlbmRzIEZpZWxkVHlwZVsnc3RydWN0dXJlJ10+IHtcbiAga2V5OiBzdHJpbmc7XG4gIHZhbHVlczogc3RyaW5nW107XG4gIHN0cnVjdHVyZTogVDtcbiAgYXBwbHk6IGJvb2xlYW47XG4gIGN1cnJlbnQ6IFQgZXh0ZW5kcyAna2V5VmFsdWUnPyBzdHJpbmc6IFNldDxzdHJpbmc+O1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCdWxrVXBkYXRlTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gIHB1YmxpYyBwcm9taXNlOiBQcm9taXNlPFJlc3VsdD47XG4gIHByaXZhdGUgcmVzb2x2ZVByb21pc2U6ICh2YWx1ZTogUmVzdWx0KSA9PiB2b2lkO1xuICBwcml2YXRlIHJlamVjdFByb21pc2U6IChyZWFzb24/OiBzdHJpbmcpID0+IHZvaWQ7XG4gIHByaXZhdGUgc3RhdGU6ICdwZW5kaW5nJyB8ICdyZXNvbHZlZCcgfCAncmVqZWN0ZWQnID0gJ3BlbmRpbmcnO1xuICBwcml2YXRlIGRhdGFzOiAoTW9kYWxEYXRhPCdrZXlWYWx1ZSc+IHwgTW9kYWxEYXRhPCdrZXlBcnJheSc+KVtdO1xuICBcbiAgc3RhdGljIGFzeW5jIEdlbmVyYXRlKGFwcDogQXBwLCBzZXR0aW5nczogRmllbGRUeXBlW10sIGN1cnJlbnRGcm9udG1hdHRlcjogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pIHtcbiAgICBjb25zdCBtb2RhbCA9IG5ldyBCdWxrVXBkYXRlTW9kYWwoYXBwLCBzZXR0aW5ncywgY3VycmVudEZyb250bWF0dGVyKVxuXG4gICAgcmV0dXJuIG1vZGFsLnByb21pc2VcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBzZXR0aW5nczogRmllbGRUeXBlW10sIGN1cnJlbnRGcm9udG1hdHRlcjogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pIHtcbiAgICBzdXBlcihhcHApO1xuICAgIFxuICAgIHRoaXMucHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UgPSAodmFsdWU6IFJlc3VsdCkgPT4ge1xuICAgICAgICB0aGlzLnN0YXRlID0gJ3Jlc29sdmVkJztcbiAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucmVqZWN0UHJvbWlzZSA9IChyZWFzb24/OiBzdHJpbmcpID0+IHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9ICdyZWplY3RlZCc7XG4gICAgICAgIHJlamVjdChyZWFzb24pO1xuICAgICAgfVxuICAgIH0pXG5cbiAgICB0aGlzLmdlbmVyYXRlRGF0YShzZXR0aW5ncywgY3VycmVudEZyb250bWF0dGVyKTtcblxuICAgIHRoaXMucmVuZGVyTW9kYWwoKVxuXG4gICAgdGhpcy5hZGRDb25maXJtKCk7XG4gICAgdGhpcy5hZGRDbG9zZSgpXG5cbiAgICB0aGlzLm9wZW4oKTtcbiAgfVxuXG4gIHJlbmRlck1vZGFsKCkge1xuICAgIGNvbnN0IHttb2RhbEVsLCB0aXRsZUVsfSA9IHRoaXM7XG5cbiAgICBtb2RhbEVsLmNsYXNzTGlzdC5hZGQoJ3lhbWxfbWFuYWdlci1idWxrX3VwZGF0ZV9tb2RhbCcpXG4gICAgdGl0bGVFbC5zZXRUZXh0KCdZYW1sJyk7XG5cbiAgICB0aGlzLnJlbmRlck1vZGFsQ29udGVudCgpO1xuICB9XG5cbiAgcmVuZGVyTW9kYWxDb250ZW50KCkge1xuICAgIGNvbnN0IHtjb250ZW50RWx9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcblxuICAgIHRoaXMuZGF0YXMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgIC8vIGZpZWxkIGNvbnRhaW5lclxuICAgICAgY29uc3QgZmllbGRDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KCk7XG4gICAgICBmaWVsZENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdmaWVsZCcpXG5cbiAgICAgIC8vIGZpZWxkIGtleSBjb250YWluZXIgICAgICBcbiAgICAgIGNvbnN0IGZpZWxkS2V5Q29udGFpbmVyID0gZmllbGRDb250YWluZXIuY3JlYXRlRGl2KCk7XG4gICAgICBmaWVsZEtleUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdmaWVsZF9rZXlfY29udGFpbmVyJyk7XG5cbiAgICAgIGNvbnN0IGFwcGx5RmllbGRTd2l0Y2hlciA9IHRoaXMuYWRkQ2hlY2tCb3goZmllbGRLZXlDb250YWluZXIsIHtcbiAgICAgICAgY2hhbmdlOiAoZXZlbnQ6IEV2ZW50KSA9PiB7XG4gICAgICAgICAgZmllbGQuYXBwbHkgPSAhZmllbGQuYXBwbHk7XG4gICAgICAgICAgdGhpcy5yZW5kZXJNb2RhbENvbnRlbnQoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBhcHBseUZpZWxkU3dpdGNoZXIuY2hlY2tlZCA9IGZpZWxkLmFwcGx5O1xuICAgICAgZmllbGRLZXlDb250YWluZXIuYXBwZW5kVGV4dChmaWVsZC5rZXkgKyAnOicpO1xuXG4gICAgICAvLyBmaWVsZCB2YWx1ZXMgY29udGFpbmVyXG4gICAgICBjb25zdCBmaWVsZFZhbHVlc0NvbnRhaWVuciA9IGZpZWxkQ29udGFpbmVyLmNyZWF0ZURpdigpXG4gICAgICBmaWVsZFZhbHVlc0NvbnRhaWVuci5jbGFzc0xpc3QuYWRkKCdmaWVsZF92YWx1ZV9jb250YWluZXInKVxuXG4gICAgICBmaWVsZC52YWx1ZXMuZm9yRWFjaCgodmFsdWUpID0+IHtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBmaWVsZFZhbHVlc0NvbnRhaWVuci5jcmVhdGVFbCgnbGFiZWwnKTtcbiAgICAgICAgbGFiZWwuY2xhc3NMaXN0LmFkZCgnZmllbGRfdmFsdWUnKTtcblxuICAgICAgICBsZXQgaW5wdXQ7XG4gICAgICAgIFxuICAgICAgICBpZiAoZmllbGQuc3RydWN0dXJlID09PSAna2V5VmFsdWUnKSB7XG4gICAgICAgICAgaW5wdXQgPSB0aGlzLmFkZFJhZGlvKGxhYmVsLCB7XG4gICAgICAgICAgICBjaGFuZ2U6IChlOiBFdmVudCkgPT4ge1xuICAgICAgICAgICAgICBmaWVsZC5jdXJyZW50ID0gKGUudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBmaWVsZC5jdXJyZW50ID09PSB2YWx1ZT8gdHJ1ZTogZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChmaWVsZC5zdHJ1Y3R1cmUgPT09ICdrZXlBcnJheScpIHtcbiAgICAgICAgICBpbnB1dCA9IHRoaXMuYWRkQ2hlY2tCb3gobGFiZWwsIHtcbiAgICAgICAgICAgIGNoYW5nZTogKGU6IEV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gKGUudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlO1xuICAgICAgICAgICAgICBmaWVsZC5jdXJyZW50Lmhhcyh2YWx1ZSk/IGZpZWxkLmN1cnJlbnQuZGVsZXRlKHZhbHVlKTogZmllbGQuY3VycmVudC5hZGQodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSAoZmllbGQuY3VycmVudCBhcyBTZXQ8c3RyaW5nPikuaGFzKHZhbHVlKT8gdHJ1ZTogZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWFwcGx5RmllbGRTd2l0Y2hlci5jaGVja2VkKSB7XG4gICAgICAgICAgaW5wdXQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpbnB1dC5uYW1lID0gZmllbGQua2V5XG4gICAgICAgIGlucHV0LnZhbHVlID0gdmFsdWU7XG4gICAgICAgIFxuICAgICAgICBsYWJlbC5hcHBlbmRUZXh0KHZhbHVlKVxuICAgICAgfSk7XG4gICAgfSlcbiAgfVxuXG4gIGdlbmVyYXRlRGF0YShzZXR0aW5nczogRmllbGRUeXBlW10sIGN1cnJlbnRGcm9udG1hdHRlcjogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pIHtcbiAgICB0aGlzLmRhdGFzID0gW107XG5cbiAgICBzZXR0aW5ncy5mb3JFYWNoKCh7a2V5LCB2YWx1ZXMsIHN0cnVjdHVyZX0pID0+IHtcbiAgICAgIGNvbnN0IGFwcGx5ID0gY3VycmVudEZyb250bWF0dGVyW2tleV0/IHRydWU6IGZhbHNlO1xuICAgICAgbGV0IGN1cnJlbnQ6IHN0cmluZyB8IFNldDxzdHJpbmc+O1xuICAgICAgaWYgKHN0cnVjdHVyZSA9PT0gJ2tleVZhbHVlJykgXG4gICAgICAgIGN1cnJlbnQgPSB0eXBlb2YgY3VycmVudEZyb250bWF0dGVyW2tleV0gPT09ICdzdHJpbmcnXG4gICAgICAgICAgPyBjdXJyZW50RnJvbnRtYXR0ZXJba2V5XSBhcyBzdHJpbmdcbiAgICAgICAgICA6ICcnIDtcbiAgICAgIGlmIChzdHJ1Y3R1cmUgPT09ICdrZXlBcnJheScpIFxuICAgICAgICBjdXJyZW50ID0gY3VycmVudEZyb250bWF0dGVyW2tleV0gaW5zdGFuY2VvZiBBcnJheVxuICAgICAgICAgID8gbmV3IFNldChjdXJyZW50RnJvbnRtYXR0ZXJba2V5XSBhcyBzdHJpbmdbXSlcbiAgICAgICAgICA6IG5ldyBTZXQoW10pO1xuXG4gICAgICB0aGlzLmRhdGFzLnB1c2goe2tleSx2YWx1ZXMsIGFwcGx5LCBzdHJ1Y3R1cmUsIGN1cnJlbnR9IGFzIE1vZGFsRGF0YTwna2V5VmFsdWUnPiB8IE1vZGFsRGF0YTwna2V5QXJyYXknPilcbiAgICB9KVxuICB9XG5cbiAgYWRkQ2hlY2tCb3goY29udGFpbmVyOiBIVE1MRWxlbWVudCwgb3B0aW9ucz86IHtjaGFuZ2U/OiAoZXZlbnQ/OiBFdmVudCkgPT4gdm9pZH0pIHtcbiAgICByZXR1cm4gdGhpcy5hZGRJbnB1dChjb250YWluZXIsICdjaGVja2JveCcsIG9wdGlvbnMpXG4gIH1cblxuICBhZGRSYWRpbyhjb250YWluZXI6IEhUTUxFbGVtZW50LCBvcHRpb25zPzoge2NoYW5nZT86IChldmVudD86IEV2ZW50KSA9PiB2b2lkfSkge1xuICAgIHJldHVybiB0aGlzLmFkZElucHV0KGNvbnRhaW5lciwgJ3JhZGlvJywgb3B0aW9ucyk7XG4gIH1cblxuICBhZGRJbnB1dChjb250YWluZXI6IEhUTUxFbGVtZW50LCB0eXBlOiBzdHJpbmcsIG9wdGlvbnM/OiB7Y2hhbmdlPzogKGV2ZW50PzogRXZlbnQpID0+IHZvaWR9KSB7XG4gICAgY29uc3QgaW5wdXQgPSBjb250YWluZXIuY3JlYXRlRWwoJ2lucHV0Jyk7XG4gICAgaW5wdXQudHlwZSA9IHR5cGU7XG5cbiAgICBvcHRpb25zICYmIE9iamVjdC5lbnRyaWVzKG9wdGlvbnMpLmZvckVhY2goKFtldmVudCwgaGFuZGxlcl0pID0+IHtcbiAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIChlOiBFdmVudCkgPT4ge1xuICAgICAgICBoYW5kbGVyKGUpO1xuICAgICAgfSlcbiAgICB9KVxuXG4gICAgcmV0dXJuIGlucHV0XG4gIH1cblxuICBhZGRDb25maXJtKCkge1xuICAgIGNvbnN0IGNvbmZpcm1CdG4gPSB0aGlzLmFkZEJ0bignQ29uZmlybScpXG5cbiAgICBjb25maXJtQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgdGhpcy5vbkNvbmZpcm0oKTtcbiAgICB9KVxuICB9XG5cbiAgYWRkQ2xvc2UoKSB7XG4gICAgY29uc3QgY2xvc2VCdG4gPSB0aGlzLmFkZEJ0bignQ2xvc2UnKTtcblxuICAgIGNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH0pXG4gIH1cblxuICBhZGRCdG4odGV4dDogc3RyaW5nKSB7XG4gICAgY29uc3Qge21vZGFsRWx9ID0gdGhpcztcbiAgICBsZXQgY29udGFpbmVyID0gbW9kYWxFbC5xdWVyeVNlbGVjdG9yKCcuYnRuX2NvbnRhaW5lcicpO1xuICAgIGlmICghY29udGFpbmVyKSB7XG4gICAgICBjb250YWluZXIgPSBtb2RhbEVsLmNyZWF0ZURpdigpO1xuICAgICAgY29udGFpbmVyLmFkZENsYXNzKCdidG5fY29udGFpbmVyJyk7XG4gICAgfVxuXG4gICAgY29uc3QgYnRuID0gY29udGFpbmVyLmNyZWF0ZUVsKCdidXR0b24nKTtcbiAgICBidG4uY2xhc3NMaXN0LmFkZChgYnRuXyR7dGV4dC50b0xvd2VyQ2FzZSgpfWApXG4gICAgYnRuLnNldFRleHQodGV4dCk7XG5cbiAgICByZXR1cm4gYnRuXG4gIH1cblxuICBvbkNvbmZpcm0oKSB7XG4gICAgY29uc3QgcmVzdWx0OiBSZXN1bHQgPSB7fTtcbiAgICB0aGlzLmRhdGFzLmZvckVhY2goKGRhdGEpID0+IHtcbiAgICAgIGlmICghZGF0YS5hcHBseSkgcmV0dXJuO1xuXG4gICAgICBpZiAoZGF0YS5zdHJ1Y3R1cmUgPT09ICdrZXlWYWx1ZScpIHJlc3VsdFtkYXRhLmtleV0gPSBkYXRhLmN1cnJlbnQgfHwgdW5kZWZpbmVkO1xuICAgICAgaWYgKGRhdGEuc3RydWN0dXJlID09PSAna2V5QXJyYXknKSByZXN1bHRbZGF0YS5rZXldID0gWy4uLmRhdGEuY3VycmVudF07XG4gICAgfSk7XG5cbiAgICB0aGlzLnJlc29sdmVQcm9taXNlKHJlc3VsdCk7XG4gICAgdGhpcy5jbG9zZSgpO1xuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgICB0aGlzLnJlamVjdFByb21pc2UoJ01vZGFsIGNsb3NlZC4nKTtcbiAgICB9XG4gIH1cbn0iLCAiaW1wb3J0IHsgU3RhdGVTd2l0Y2hlclNldHRpbmdzIH0gZnJvbSBcIi4vc2V0dGluZ1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gbWFrZUNvbXBhdGlibGUoc2V0dGluZzogU3RhdGVTd2l0Y2hlclNldHRpbmdzKSB7XG4gIHNldHRpbmcuc3RhdGVNYXBzLmZvckVhY2goKG1hcCkgPT4ge1xuICAgIG1hcC5zdHJ1Y3R1cmUgPSBtYXAuc3RydWN0dXJlID8/ICdrZXlWYWx1ZSc7XG4gIH0pXG5cbiAgcmV0dXJuIHNldHRpbmc7XG59Il0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7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
